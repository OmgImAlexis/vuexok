(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{364:function(t,s,e){"use strict";e.r(s);var r=e(42),a=Object(r.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"экшены-из-воркера"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#экшены-из-воркера"}},[t._v("#")]),t._v(" Экшены из воркера")]),t._v(" "),e("p",[t._v('Для "разгрузки" основного потока применяются '),e("a",{attrs:{href:"https://developer.mozilla.org/ru/docs/DOM/Using_web_workers",target:"_blank",rel:"noopener noreferrer"}},[t._v("воркеры"),e("OutboundLink")],1),t._v(". В воркере можно проводить сложные вычисления, которые могли бы привести к просадкам в основном потоке. И затем необходимо передать результат вычислений в основной поток. Если вы используете vuex, то чаще всего вам будет необходимо результаты вычисления воркеров передать в хранилище.")]),t._v(" "),e("p",[t._v("С Vuexok это сделать очень просто. Vuexok позволяет проксировать методы экшенов в воркеры.")]),t._v(" "),e("h2",{attrs:{id:"доработка-инициализации-воркера"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#доработка-инициализации-воркера"}},[t._v("#")]),t._v(" Доработка инициализации воркера")]),t._v(" "),e("p",[t._v("После инициализации воркера надо передать его в метод "),e("code",[t._v("vuexokWorkerWrapper")])]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" vuexokWorkerWrapper "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vuexok/dist/src/vuexokWorkerWrapper'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" worker "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Worker")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./worker'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("vuexokWorkerWrapper")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("worker"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("p",[t._v("При этом вы можете так же использовать "),e("a",{attrs:{href:"https://github.com/GoogleChromeLabs/comlink",target:"_blank",rel:"noopener noreferrer"}},[t._v("comlink"),e("OutboundLink")],1),t._v(" вместе с vuexok.")]),t._v(" "),e("h2",{attrs:{id:"доработка-воркера"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#доработка-воркера"}},[t._v("#")]),t._v(" Доработка воркера")]),t._v(" "),e("p",[t._v("Теперь перейдем к коду воркера. Что бы в воркере были доступны экшены модуля достаточно буквально 3 строки.\nВ коде воркера импортируем метод "),e("code",[t._v("vuexokWorkerGetActions")]),t._v(", который нам вернет методы для вызова экшенов модуля.")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" vuexokWorkerGetActions "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vuexok/dist/vuexokWorkerGetActions'")]),t._v("\n")])])]),e("p",[t._v("Воркер ничего не знает о нашем сторе и модулях, поэтому надо импортировать в воркер тип модуля.")]),t._v(" "),e("p",[t._v("Так как мы не хотим, чтобы в воркере был vuex и код нашего модуля, то импортируем только тип модуля. Typescript версии выше "),e("a",{attrs:{href:"https://devblogs.microsoft.com/typescript/announcing-typescript-3-8-beta/",target:"_blank",rel:"noopener noreferrer"}},[t._v("3.8"),e("OutboundLink")],1),t._v(" позволяет импортировать только тип.")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" type "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("countModule"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@/store/modules/countModule'")]),t._v("\n")])])]),e("p",[t._v("Теперь мы можем получить доступ к экшенам нашего модуля из воркера. Метод "),e("code",[t._v("vuexokWorkerGetActions")]),t._v(" принимает один обязательный параметр - путь к модулю vuex.")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" countModuleActions "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vuexokWorkerGetActions"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" countModule"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'countModule'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("p",[t._v("Простой пример (20 секунд)\n"),e("video",{staticStyle:{width:"100% !important",height:"auto!important"},attrs:{width:"560",height:"240",controls:""}},[e("source",{attrs:{src:"/vuexok/video/createWorker.mp4",type:"video/mp4"}}),t._v("\nYour browser does not support the video tag.\n")])])])}),[],!1,null,null,null);s.default=a.exports}}]);